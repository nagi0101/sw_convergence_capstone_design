# SGAPS-MAE Server Configuration

defaults:
    - server: development
    - sampling: hybrid # Phase 3: Use adaptive importance-based sampling
    - debug: enabled # Debug visualization system
    - mask_update: fixed
    - training: phase1
    - data: base
    - logging: wandb
    - skip: enabled # Skip connection configuration (default: enabled)
    - pe: gaussian # Positional encoding configuration (default: gaussian fourier)
    - cleaning: default # Data cleaning configuration
    - _self_

# --- Paths ---
# Referenced by other config files like data/base.yaml
paths:
    data_root: "./data"
    checkpoint_dir: "./checkpoints"
    output_dir: "./outputs/${now:%Y-%m-%d}/${now:%H-%M-%S}"

# --- Hydra Settings ---
hydra:
    run:
        dir: ${paths.output_dir}

# --- Global settings ---
max_state_dim: 64
sentinel_value: -999.0
target_fps: 5
seed: 42

# Data storage
storage:
    base_path: "./data"
    format: "hdf5"

# Reconstruction settings (Phase 1: OpenCV inpainting)
reconstruction:
    method: "opencv_inpaint"
    inpaint_radius: 3

# Model settings (Phase 2: Sparse Pixel Transformer)
model:
    name: "spt_base"

    # Input constraints
    input_constraints:
        max_state_dim: ${max_state_dim}

    # Sentinel value for state masking (spt.py:54 requires this)
    sentinel_value: ${sentinel_value}

    # Architecture parameters (spt.py:49-52, 76-77 requires this structure)
    architecture:
        embed_dim: 256 # 임베딩 차원
        num_heads: 8 # Attention heads
        num_encoder_layers: 6 # Sparse Transformer Encoder layers
        num_decoder_layers: 4 # Cross-Attention Decoder layers
        feedforward_dim: 1024 # FFN 중간 차원
        dropout: 0.1
        
        # Skip connection settings (managed via conf/skip/*.yaml)
        skip: ${skip}

    # Positional encoding settings (managed via conf/pe/*.yaml)
    positional_encoding: ${pe}

    # CNN Refinement Head
    refinement_head:
        channels: [128, 64, 32] # Progressive channel reduction

    # Color channels (for future RGB support)
    color_channels: 1

# Loss function settings (Phase 3)
loss:
    # MVP: Sampled Pixel L2 Loss only
    type: "sampled_pixel_l2"

# Importance calculation settings (Phase 2)
importance:
    method: "attention_entropy"
    epsilon: 1.0e-9 # log(0) 방지용
